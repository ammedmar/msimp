\subsection{Simplicial model}\label{ss:simplicial model}

%Then we compare this model
We consider now another $E_\infty$-model of  configuration space coming from a simplicial set $\BE(r)$, equipped with a complete graph filtration
\[
\BE_{1}(r) \subset \BE_{2}(r) \subset \dotsb \,.
\]

The $n$-simplices of $\BE(r)$ are tuples of $n+1$ elements of the symmetric group $\sym_r$.
Its face and degeneracy maps are defined by removing and doubling elements respectively.
There is an operad structure on these simplicial sets, but we do not consider it here.
The complete graph filtration of $\BE(r)$ by simplicial subsets $\BE_n(r)$ is given as follows.

\begin{definition}[Filtration of the Barratt--Eccles simplicial set $\BE(r)$]
	Fix an element $w \in \BE(r)_{d}$, $w=(w_{1},\dots , w_{d})$ with $w_{h}\in \sym_r$.
 	For any pair $(i,j)$ with $i< j$, denote $w_{ij}=(w_{1,ij},\dots , w_{d,ij})$ where $w_{h,ij}$ is the subsequence of $w_{h}$ obtained omitting all the occurrences of elements different from $i$ and $j$.
	%	For example, let $(123,231,312) \in (\BE_3)_{3}$, we have $(123,231,312)_{12}=(12,21,12)$, $(123,231,312)_{23}=(23,23,32)$ and $(123,231,312)_{13}=(13,31,31 )$.
	The element $w$ belongs to $\BE_{(\mu,\sigma)}(r)\subseteq \BE(r)$ if for all pairs $(i,j)$, $i< j$ either along the sequence $w_{ij}$ $i$ and $j$ swap less than $\mu_{ij}$ times,
	%	, that is, as before, the amount of times that the order of $i$ and $j$ change ,
	or they swap exactly $\mu_{ij}$ times and the first permutation $w_{1,ij}$ is equal to $\sigma_{ij}$.
	Notice that
	\begin{equation*}
		\label{def}
		\BE_{n}(r)=\bigcup_{\max_{i<j} (\mu_{ij})< n} \BE_{(\mu,\sigma)}(r)
	\end{equation*}
	%	Returning to the example above we have $\mu_{12}(123,231,312)=2$, $\mu_{23}(123,231,312)=1$ and $\mu_{13}(123,231,312)=1$ so that $(123,231,312)\in (\cW_{(\mu,\sigma)}\sym_3)_{3}$
	%	\begin{itemize}
		%		\item if $\mu_{12}>2$, $\mu_{23}>1$ and $\mu_{13}>1$ and any $\sigma\in \sym_{3}$;
		%		\item if some $\mu_{ij}=\mu_{ij}(w)$ and the first permutation of $w$ is equal to $\sigma_{ij}$.
		%	\end{itemize}
	%	In our example we obtain that, by equation \ref{def},
	%	$(123,231,312)\in (\cW_{3}\sym_3)_{3}$
	%	\\
	%	\\
	%	We have obtained the filtration $$\cW_1\sym_k \subset \cW_2 \sym_k
	%	\subset \cW_3 \sym_k
	%	\subset \dots $$
	%	that is the other one we need in $tc$ definition.
\end{definition}

It has been proven in \cite{kashiwabara1993confcomplex} that $\con{r}(\R^d)$ is homotopy equivalent to $\bars{\BE_{d}(r)} $.
The filtration of the Barratt-Eccles simplicial set induces naturally a filtration of the normalized chain complex $\cE(r):=\chains \BE(r)$
\[
\cE_{1}(r) \subset \cE_{2}(r) \subset \dotsb \,.
\]
The complex $\cE(r)$ is known as Barratt-Eccles chain complex.

Let us write an element of $\sigma \in \sym_r$ as $\sigma(1)\sigma(2) \dots \sigma(r)$.
Then $(\sigma_0,\dots,\sigma_m) \in \BE_{d}(r)$ if for distinct $i,j \in \set{1,\dots,r}$ their order of appearance in $\sigma_\ell$ swaps at most $d-1$ times as $\ell$ increases from $0$ to $m$.
For example $w = (123,213,312) \in \BE_{3}(3)$ but $w \notin \BE_{2}(3)$ because the position of $1$ and $2$ swaps two times.
The symmetric group $\sym_r$ acts on $\BE(r)$ by diagonal left multiplication and the action preserves the filtration.

Similarly to the construction of an explicit zig-zag of equivariant quasi-isomorphisms of $E_\infty$-coalgebras constructed for the chains of the multisimplicial model (\cref{ss:surjection model}) we have the following zig-zag of such maps
\[
\schains\con{r}(\R^d) \leftarrow \schains \bars{\mathcal{N}(\CG_{d}(r))} \to \schains\bars{\BE_{d}(r)} \leftarrow \chains \BE_{d}(r) = \cE_d(r).
\]
Combining these two constructions we have the following.
\begin{theorem}
	The chains on the simplicial and multisimplicial models of a configuration space are related by an explicit zig-zag of equivariant quasi-isomorphism of $E_\infty$-coalgebras.
\end{theorem}

\subsection{Table completion}\label{ss:table completion}

It is desirable to have a direct equivariant quasi-isomorphism between these algebraic models.
Two filtration preserving quasi-isomorphisms were constructed by Berger--Fresse
\[
\TR \colon \chains\BE(r) \to \chains\sur(r)
\quad \text{and} \quad
\TC \colon \chains\sur(r) \to \chains \BE(r).
\]
%\[
%\TR \colon \cE(r) \to \cX(r)
%\quad \text{and} \quad
%\TC \colon \cX(r) \to \cE(r).
%\]
The first one, introduced in \cite[1$\cdot$3]{berger2004combinatorial}, is not a coalgebra map, as the reader familiar with its definition can easily verify.
We will focus on the second one which was introduced in \cite{berger2002prismatic} and termed \textit{table completion}.
We will construct a factorization
\[
\TC \colon \chains\sur(r) \xra{\EZ} \chains\sur(r)^\diag \xra{\chains(\tc)} \chains \BE(r),
\]
where the second map is induced from a simplicial one defined below.
This factorization proves that $\TC$ is a coalgebra map since both factors are.
We warn the reader that, since $\EZ$ does not respect the $E_\infty$-coalgebra structure,
neither does $\TC$.
For example, using calculations from \cite{medina2022cube_einfty} and \cite{berger2002prismatic}, we have
\[
\Delta_1 \circ TC\big(12312) \neq
\TC ^{\otimes 2}\, \circ \, \Delta_1\big(12312\big).
\]

%In this section we construct an explicit combinatorial map between the surjection complex and the Barratt--Eccles complex, that respects filtrations, inducing weak equivalences of subcomplexes.
%Furthermore it upgrades a map previously defined on the chain level by Berger and Fresse: they constructed in \cite{BFsmall}
%an operad map $TR:BE \to \chi$ preserving the filtrations and a collection of $\sym_k$-equivariant
%chain maps $TC(k):\chi(k) \to BE(k)$ preserving filtrations
%that are right inverses of $TR(k)$ but do not form an operad map.
%We warn the reader that neither $TR$ nor $TC$ preserve the $E_\infty$-coalgebra structure, but
%$TC$ preserves the $E_1$-coalgebra structure.
%
%We claim that $TC$ is induced by a map of simplicial sets
%$$tc: \sur(k)^D \to \BE_k$$ that we define.

%\begin{definition*}
%	Let $s$ be an $i$-simplex of the diagonal $\sur(k)^D$, i.e. a sequence containing any value in $\{1,\dots,k\}$ exactly $i+1$ times.
%	Then $tc(s):=(\sigma_0,\dots,\sigma_i)$ is a sequence of permutations where $\sigma_j$ is the subsequence of $s$ containing the $(j+1)$-st occurrence of each value in $\{1,\dots,k\}$.
%\end{definition*}

Let $s$ be an $m$-simplex of the diagonal $\sur(r)^D$, i.e. a sequence containing every $j \in \{1,\dots,k\}$ exactly $m+1$ times.
We define
\[
\tc(s) = (\sigma_0,\dots,\sigma_m)
\]
with $\sigma_j$ represented by the subsequence of $s$ containing the $(j+1)^{\mathrm{st}}$ occurrence of each value in $\{1,\dots,r\}$.
For example, we have
\[
\tc(122333112) = (123,231,312).
\]
The diagonal simplicial set $\sur(r)^\diag$ has an induced complete graph filtration given by restriction of definition \ref{surfiltration}, and we have the following.

\begin{theorem}
	The simplicial map $\tc \colon \sur(r)^\diag \to \BE(r)$ is a filtration preserving weak equivalence. Moreover it induces weak equivalences $$\tc_{n} \colon \sur_{n}(r)^{D}\rightarrow \BE_{n}(r)$$
\end{theorem}

%\begin{lemma}[Compatibility of $tc$]
%	We have that the map $tc:\sur(k)^{D}\rightarrow \BE_{k}$ is compatible with the filtrations, in the sense that
%	$$tc(\sur_{(\mu,\sigma)}(k)^{D})\subseteq \cW_{(\mu,\sigma)}\sym_{k}$$
%	and in particular
%	$$tc(\sur_{n}(k)^{D})\subseteq \cW_{n}\sym_{k}$$
%\end{lemma}

\begin{proof}
	Let $f\in \sur(r)^{D}$ be an $m$-simplex and denote
	$$tc(f)=w=(w_{1},\dots,w_{m+1})\in \chains\BE(r)_{m+1}$$
	Suppose that in $f_{ij}$ $i$ and $j$ alternate $\mu_{ij}$ times, and in $w_{ij}$ $i$ and $j$ alternate $\mu_{ij}'$ times.
	We will prove that
	$\mu_{ij}' \leq \mu_{ij}$.

	Suppose without loss of generality that $i$ occurs before $j$ in $f_{ij}$, that starts with $i$ repeated $h$ times, followed by $j$ repeated $l$ times, and
	then by $i$ again (or terminating).
	If the sequence terminates then $h=l=k$ and $\mu_{ij}=\mu_{ij}'=0$.
	For $h <l$
	let $\bar{f}_{ij}$ be the subsequence of $f_{ij}$
	obtained taking out the first $h$ values of $i$ and of $j$.
	Let $\bar{\mu}_{ij}$ be the number of variations of $i$ and $j$ in $\bar{f}_{ij}$
	and $\bar{\mu}'_{ij}$ the number of variations of $i$ and $j$ in $tc(\bar{f}_{ij})$.

	Then $\bar{f}_{ij}$
	starts with $j$,
	$\mu_{i,j}=1+\bar{\mu}_{ij}$,
	and $\mu'_{ij}=1+\bar{\mu}'_{ij}$.

	If $h \geq l$ and $l<r$
	let $\bar{f}_{ij}$ be the subsequence of $f_{ij}$ obtained taking out the first $l$ values of $i$ and $j$.
	Then $\bar{f}_{ij}$
	starts with $i$,
	$\mu_{i,j}=1+\bar{\mu}_{ij}$,
	and $\mu'_{ij}=\bar{\mu}'_{ij}$.
	By induction on the length of sequences we obtain that
	$\mu_{ij}'\le \mu_{ij}$.\\
	Moreover $tc$ is compatible with orderings: the first occurrences of $i$ and $j$ form the ordering $w_{1,ij}$ that is the first permutation of $tc(f_{ij})$.
	This concludes the proof of the first assertion.

	Regarding the maps $\tc_{n} \colon \sur_{n}(r)^{D}\rightarrow \BE_{n}(r)$ we can express source and target as colimits of contractible %ok?
	simplicial sets along the poset of complete graphs,
	so we have a commutative diagram
	\begin{equation*}
		\begin{tikzcd}			hocolim_{(\mu,\sigma)}\sur_{(\mu,\sigma)}(r)^{D} \arrow[r] \arrow[d]& hocolim_{(\mu,\sigma)}\BE_{(\mu,\sigma)}(r) \arrow[d] \\
			\sur_{n}(r)^{D}\arrow[r] & \BE_{n}(r)&
		\end{tikzcd}
	\end{equation*}
	Where the vertical and top arrows
	are weak equivalences, and so the bottom map is a weak equivalence.
\end{proof}
As a consequence of $tc$ definition and by the above theorem one can easily verify:
\begin{proposition}
    The homomorphism $TC$ by Berger-Fresse satisfies $$TC=\chains(tc)\circ EZ $$
\end{proposition}

%Let $F_k(\R^{d})$ be the ordered configuration %space of $k$-tuples of points in $\R^{d}$.

%\begin{proposition}
%The geometric realizations satisfy
%$$|\sur_d(k)| \simeq |W_d(k)| \simeq F_k(\R^{d})$$
%\end{proposition}

%\begin{proof}
%The configuration space is homotopy equivalent to %the homotopy colimit of contractible spaces along %the same poset as above, as shown by McClure and %Smith \cite{mcclure2003multivariable}. %this is originally Berger's %criterion..
%\end{proof}

% In both cases, to see even the role of permutations we'll use always pairs $(\mu,\sigma)$ with $\mu$ exactly the collection of variation numbers obtained from the initial element so that the permutation is uniquely determined, and $(\mu,\sigma)$ is minimal in the poset.
% \\
% In our examples
% \begin{itemize}
	% 	\item $31231\in \sur_{(\mu,\sigma)}(3)_{2,1,2} \subseteq \sur_{3}(3)_{2,1,2}$ with $(\mu_{12},\mu_{13},\mu_{23})=(1,2,1)$ and $\sigma=(312)$
	% 	\item $(123,231,312)\in (\cW_{(\mu,\sigma)}\sym_3)_{3} \subset (\cW_{3}\sym_3)_{3}$ with $(\mu_{12},\mu_{13},\mu_{23})=(2,1,1)$ and $\sigma=(123)$
	% \end{itemize}
%	We observe that the simplicial map $tc$ respects the filtration, sending
%	$\sur_d(k)^D$ to $\cW_d\sym_k$
%	\\
%	\begin{example}
	%	We are givine some example of the compatibility of $tc$ to visualize why it works in general.
	%	Let $122333112 \in \sur(3)^{D} $
	%	\begin{itemize}
		%		\item $(122333112)_{12}=122112\rightarrow \mu_{12}=2$
		%		\item $(122333112)_{13}=133311\rightarrow \mu_{13}=1$
		%		\item $(122333112)_{23}=223332\rightarrow \mu_{23}=1$
		%	\end{itemize}
	%So $\mu=(\mu_{12},\mu_{13},\mu_{23})=(2,1,1)$
	%and the first occurrences of $1,2,3$ give us the permutation $\sigma=(123)$ $\Rightarrow$ $122333112 \in \sur_{((2,1,1),(123))}(3)^{D}$ $\Rightarrow$ $122333112 \in \sur_{3}(3)^{D}$.
	%Now applying $tc$ we obtain $tc(122333112)=(123,231,312)\in (\BE_3)_{3} $
	%\begin{itemize}
	%\item $(123,231,312)_{12}=(12,21,12)\rightarrow \mu_{12}=2$
	%\item $(123,231,312)_{13}=(13,31,31)\rightarrow \mu_{13}=1$
	%\item $(123,231,312)_{23}=(23,23,32)\rightarrow \mu_{23}=1$
	%\end{itemize}
	%So $\mu=(\mu_{12},\mu_{13},\mu_{23})=(2,1,1)$
	%and the first permutation in $(123,231,312)$ give us the permutation $\sigma=(123)$ $\Rightarrow$ $(123,231,312) \in (\cW_{((2,1,1),(123))}\sym_{3})_{3}$ $\Rightarrow$ $(123,231,312) \in (\cW_{3}\sym_{3})_{3}$.
	%
	%
	%
	%	\end{example}