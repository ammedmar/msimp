% !TEX root = ../msimp.tex

\subsection{Table completion}\label{ss:table completion}

It is desirable to have a direct $\sym_r$-equivariant quasi-isomorphism between these algebraic models.
Two filtration preserving quasi-isomorphisms were constructed by Berger--Fresse
\[
\TR \colon \chains\BE(r) \to \chains\sur(r)
\quad \text{and} \quad
\TC \colon \chains\sur(r) \to \chains \BE(r).
\]
The first one, introduced in \cite[1$\cdot$3]{berger2004combinatorial}, is not a coalgebra map, as the reader familiar with its definition can easily verify.
We will focus on the second one which was introduced in \cite{berger2002prismatic} and termed \textit{table completion}.
We will construct a factorization
\[
\TC \colon \chains\sur(r) \xra{\EZ} \chains\sur(r)^\diag \xra{\chains(\tc)} \chains \BE(r),
\]
where the second map is induced from a simplicial one defined below.
This factorization proves that $\TC$ is a coalgebra map since both factors are.
We warn the reader that since $\EZ$ does not respect the $E_\infty$-coalgebra structure,
neither does $\TC$.
For example, we have
\[
\Delta_1 \circ \TC\big(12312) \neq \TC^{\otimes 2} \circ \, \Delta_1 \big(12312\big).
\]

Let us give a more explicit description of the simplicial set $\sur(r)^\diag$.
Its $n$-simplices are represented by maps
\[
f \colon \set{1,\dots,rm+r} \to \set{1,\dots,r},
\]
satisfying that the cardinality of $f^{-1}(\ell)$ is $m+1$ for each $\ell \in \set{1,\dots,r}$.
We represented this simplex by the sequence $f(1) \dotsb f(rm+r)$.
The $i^\th$ face and degeneracy maps act on it respectively by removing or doubling the $i^\th$ occurrence of each $\ell \in \set{1,\dots,r}$ in $f(1) \dotsb f(rm+r)$.

The $\CG(r)$-filtration of $\sur(r)$
induces naturally through the diagonal functor a $\CG(r)$-filtration of its diagonal $\sur(r)^\diag$,
\[
\sur_1(r)^\diag \subset \sur_2(r)^\diag \subset \dotsb
\]
Also in terms of cellular $\CG(r)$-decompositions, $\bars{\sur_d(r)^\diag}$ had an induced cellular $\CG_d(r)$-decompositions from those on $\bars{\sur_d(r)}$ by virtue of the homeomorphism $\bars{X} \cong \bars{X^\diag}$ for any multisimplicial set $X$.

Since it can be easily seen that the alternation number of elements of $\sur(r)$ is unchanged by $\EZ \colon \chains\sur(r) \to \chains\sur(r)^\diag$, $\CG(r)$-filtrations are preserved by Eilenbergâ€“Zilber  map.

Let us now define the simplicial map $\tc$.
For $f$ as above, let
\[
\tc(f) = (\sigma_0,\dots,\sigma_m)
\]
with $\sigma_j$ represented by the subsequence of $f$ containing the $(j+1)^{\mathrm{st}}$ occurrence of each $\ell \in \{1,\dots,r\}$.
For example, we have
\[
\tc(122333112) = (123,231,312).
\]

\begin{theorem}
	The simplicial map $\tc \colon \sur(r)^\diag \to \BE(r)$ satisfies
	\[
	\TC = \chains(\tc) \circ \EZ
	\]
	and induces a weak equivalence
	\[
	\tc_d \colon \sur_d(r)^\diag \to \BE_d(r)
	\]
	for every $r,d \in \N$.
\end{theorem}

\begin{proof}
	It is clear that $\tc$ is a simplicial map, and verifying its relationship with Berger--Fresse's chain map is straightforward using ???\todo{Any insights here? Maybe exact page to compare to?}

	To check that $\tc$ preserves $\CG(r)$-filtrations let us first notice that $\tc(f)_{ij} = \tc(f_{ij})$, so without loss of generality we can assume $r=2$.
	In this case it is clear that non-degenerate simplices are sent to non-degenerate simplices (of the same dimension), so for these the complexity is preserved.
	We conclude the same for degenerate simplices using that $\tc$ is a simplicial map and that degeneracy maps leave complexity unchanged.

	For each $(\mu,\sigma) \in \CG_d(r)$, the cell $\bars{\sur^\diag(r)}_{(\mu,\sigma)}$ is mapped to the cell $\bars{\BE(r)}_{(\mu,\sigma)}$ since the order in which $i$ and $j$ first appear in $f_{ij}$ determines the first simplex in $\tc(f)_{ij}$.
	The final claim then follows from \cref{p:cellular poset decomposition}.
\end{proof}